
#include <stdio.h>
#include <math.h>

int vbic_4T_it_xf_f(p
	,Vbei,Vbex,Vbci,Vbep,Vbcp,Vrxf
	,Vrcx,Vbcx,Vrci,Vrbx,Vrbi,Vre,Vrbp
	,Vrs,Vbe,Vbc,Vcxf,Ibe,Ibex,Itxf
	,Itzr,Ibc,Ibep,Ircx,Irci,Irbx,Irbi
	,Ire,Irbp,Qbe,Qbex,Qbc,Qbcx,Qbep
	,Qbeo,Qbco,Ibcp,Iccp,Irs,Qbcp,Ixzf
	,Ixxf,Qcxf,Flxf,SCALE)
double *p
	,*Vbei,*Vbex,*Vbci,*Vbep,*Vbcp,*Vrxf
	,*Vrcx,*Vbcx,*Vrci,*Vrbx,*Vrbi,*Vre,*Vrbp
	,*Vrs,*Vbe,*Vbc,*Vcxf,*Ibe,*Ibex,*Itxf
	,*Itzr,*Ibc,*Ibep,*Ircx,*Irci,*Irbx,*Irbi
	,*Ire,*Irbp,*Qbe,*Qbex,*Qbc,*Qbcx,*Qbep
	,*Qbeo,*Qbco,*Ibcp,*Iccp,*Irs,*Qbcp,*Ixzf
	,*Ixxf,*Qcxf,*Flxf,*SCALE;
{
double	Vtv,IVEF,IVER,IIKF,IIKR,IIKP,IVO;
double	IHRCF,IVTF,IITF,slTF,LEP,CEP,dv0;
double	dvh,xvar1,xvar2,pwq,qlo,qhi,xvar3;
double	qdbe,mv0,vl0,q0,dv,mv,vl;
double	qdbex,qdbc,vn0,vnl0,qlo0,vn,vnl;
double	sel,crt,cmx,cl,ql,qdbep,qdbcp;
double	argi,expi,Ifi,Iri,q1z,q1,q2;
double	xvar4,qb,Itzf,argx,expx,Ifp,q2p;
double	qbp,Irp,argn,expn,Ibcj,avalf,Igc;
double	Kbci,Kbcx,rKp1,Iohm,derf,sgIf,rIf;
double	mIf,tff;
double	TNOM,RCX,RCI,VO,GAMM,HRCF,RBX;
double	RBI,RE,RS,RBP,IS,NF,NR;
double	FC,CBEO,CJE,PE,ME,AJE,CBCO;
double	CJC,QCO,CJEP,PC,MC,AJC,CJCP;
double	PS,MS,AJS,IBEI,WBE,NEI,IBEN;
double	NEN,IBCI,NCI,IBCN,NCN,AVC1,AVC2;
double	ISP,WSP,NFP,IBEIP,IBENP,IBCIP,NCIP;
double	IBCNP,NCNP,VEF,VER,IKF,IKR,IKP;
double	TF,QTF,XTF,VTF,ITF,TR,TD;
double	VRT,ART,CCSO,QBM,NKF,ISRR,VBBE;
double	NBBE,IBBE,EBBE;

/*	Map parameter array into symbolic names */

	TNOM=p[0];
	RCX=p[1];
	RCI=p[2];
	VO=p[3];
	GAMM=p[4];
	HRCF=p[5];
	RBX=p[6];
	RBI=p[7];
	RE=p[8];
	RS=p[9];
	RBP=p[10];
	IS=p[11];
	NF=p[12];
	NR=p[13];
	FC=p[14];
	CBEO=p[15];
	CJE=p[16];
	PE=p[17];
	ME=p[18];
	AJE=p[19];
	CBCO=p[20];
	CJC=p[21];
	QCO=p[22];
	CJEP=p[23];
	PC=p[24];
	MC=p[25];
	AJC=p[26];
	CJCP=p[27];
	PS=p[28];
	MS=p[29];
	AJS=p[30];
	IBEI=p[31];
	WBE=p[32];
	NEI=p[33];
	IBEN=p[34];
	NEN=p[35];
	IBCI=p[36];
	NCI=p[37];
	IBCN=p[38];
	NCN=p[39];
	AVC1=p[40];
	AVC2=p[41];
	ISP=p[42];
	WSP=p[43];
	NFP=p[44];
	IBEIP=p[45];
	IBENP=p[46];
	IBCIP=p[47];
	NCIP=p[48];
	IBCNP=p[49];
	NCNP=p[50];
	VEF=p[51];
	VER=p[52];
	IKF=p[53];
	IKR=p[54];
	IKP=p[55];
	TF=p[56];
	QTF=p[57];
	XTF=p[58];
	VTF=p[59];
	ITF=p[60];
	TR=p[61];
	TD=p[62];
	VRT=p[85];
	ART=p[86];
	CCSO=p[87];
	QBM=p[88];
	NKF=p[89];
	ISRR=p[94];
	VBBE=p[98];
	NBBE=p[99];
	IBBE=p[100];
	EBBE=p[104];

/*	Function only code */

	Vtv=1.380662e-23*(2.731500e+02+TNOM)/1.602189e-19;
	if(VEF>0.0){
		IVEF=1.0/VEF;
	}else{
		IVEF=0.0;
	}
	if(VER>0.0){
		IVER=1.0/VER;
	}else{
		IVER=0.0;
	}
	if(IKF>0.0){
		IIKF=1.0/IKF;
	}else{
		IIKF=0.0;
	}
	if(IKR>0.0){
		IIKR=1.0/IKR;
	}else{
		IIKR=0.0;
	}
	if(IKP>0.0){
		IIKP=1.0/IKP;
	}else{
		IIKP=0.0;
	}
	if(VO>0.0){
		IVO=1.0/VO;
	}else{
		IVO=0.0;
	}
	if(HRCF>0.0){
		IHRCF=1.0/HRCF;
	}else{
		IHRCF=0.0;
	}
	if(VTF>0.0){
		IVTF=1.0/VTF;
	}else{
		IVTF=0.0;
	}
	if(ITF>0.0){
		IITF=1.0/ITF;
	}else{
		IITF=0.0;
	}
	if(ITF>0.0){
		slTF=0.0;
	}else{
		slTF=1.0;
	}
	if(TD>0.0){
		LEP=TD/3.0;
	}else{
		LEP=0.0;
	}
	if(TD>0.0){
		CEP=TD;
	}else{
		CEP=0.0;
	}
	dv0=-PE*FC;
	if(AJE<=0.0){
		dvh=(*Vbei)+dv0;
		if(dvh>0.0){
			xvar1=(1.0-FC);
			xvar2=(-1.0-ME);
			pwq=pow(xvar1,xvar2);
			qlo=PE*(1.0-pwq*(1.0-FC)*(1.0-FC))/(1.0-ME);
			qhi=dvh*(1.0-FC+0.5*ME*dvh/PE)*pwq;
		}else{
			xvar1=(1.0-(*Vbei)/PE);
			xvar2=(1.0-ME);
			xvar3=pow(xvar1,xvar2);
			qlo=PE*(1.0-xvar3)/(1.0-ME);
			qhi=0.0;
		}
		qdbe=qlo+qhi;
	}else{
		mv0=sqrt(dv0*dv0+4.0*AJE*AJE);
		vl0=-0.5*(dv0+mv0);
		xvar1=(1.0-vl0/PE);
		xvar2=(1.0-ME);
		xvar3=pow(xvar1,xvar2);
		q0=-PE*xvar3/(1.0-ME);
		dv=(*Vbei)+dv0;
		mv=sqrt(dv*dv+4.0*AJE*AJE);
		vl=0.5*(dv-mv)-dv0;
		xvar1=(1.0-vl/PE);
		xvar2=(1.0-ME);
		xvar3=pow(xvar1,xvar2);
		qlo=-PE*xvar3/(1.0-ME);
		xvar1=(1.0-FC);
		xvar2=(-ME);
		xvar3=pow(xvar1,xvar2);
		qdbe=qlo+xvar3*((*Vbei)-vl+vl0)-q0;
	}
	dv0=-PE*FC;
	if(AJE<=0.0){
		dvh=(*Vbex)+dv0;
		if(dvh>0.0){
			xvar1=(1.0-FC);
			xvar2=(-1.0-ME);
			pwq=pow(xvar1,xvar2);
			qlo=PE*(1.0-pwq*(1.0-FC)*(1.0-FC))/(1.0-ME);
			qhi=dvh*(1.0-FC+0.5*ME*dvh/PE)*pwq;
		}else{
			xvar1=(1.0-(*Vbex)/PE);
			xvar2=(1.0-ME);
			xvar3=pow(xvar1,xvar2);
			qlo=PE*(1.0-xvar3)/(1.0-ME);
			qhi=0.0;
		}
		qdbex=qlo+qhi;
	}else{
		mv0=sqrt(dv0*dv0+4.0*AJE*AJE);
		vl0=-0.5*(dv0+mv0);
		xvar1=(1.0-vl0/PE);
		xvar2=(1.0-ME);
		xvar3=pow(xvar1,xvar2);
		q0=-PE*xvar3/(1.0-ME);
		dv=(*Vbex)+dv0;
		mv=sqrt(dv*dv+4.0*AJE*AJE);
		vl=0.5*(dv-mv)-dv0;
		xvar1=(1.0-vl/PE);
		xvar2=(1.0-ME);
		xvar3=pow(xvar1,xvar2);
		qlo=-PE*xvar3/(1.0-ME);
		xvar1=(1.0-FC);
		xvar2=(-ME);
		xvar3=pow(xvar1,xvar2);
		qdbex=qlo+xvar3*((*Vbex)-vl+vl0)-q0;
	}
	dv0=-PC*FC;
	if(AJC<=0.0){
		dvh=(*Vbci)+dv0;
		if(dvh>0.0){
			xvar1=(1.0-FC);
			xvar2=(-1.0-MC);
			pwq=pow(xvar1,xvar2);
			qlo=PC*(1.0-pwq*(1.0-FC)*(1.0-FC))/(1.0-MC);
			qhi=dvh*(1.0-FC+0.5*MC*dvh/PC)*pwq;
		}else{
			if((VRT>0.0)&&((*Vbci)<-VRT)){
				xvar1=(1.0+VRT/PC);
				xvar2=(1.0-MC);
				xvar3=pow(xvar1,xvar2);
				qlo=PC*(1.0-xvar3*(1.0-((1.0-MC)*((*Vbci)+VRT))/(PC+VRT)))/(1.0-MC);
			}else{
				xvar1=(1.0-(*Vbci)/PC);
				xvar2=(1.0-MC);
				xvar3=pow(xvar1,xvar2);
				qlo=PC*(1.0-xvar3)/(1.0-MC);
			}
			qhi=0.0;
		}
		qdbc=qlo+qhi;
	}else{
		if((VRT>0.0)&&(ART>0.0)){
			vn0=(VRT+dv0)/(VRT-dv0);
			vnl0=2.0*vn0/(sqrt((vn0-1.0)*(vn0-1.0)+4.0*AJC*AJC)+sqrt((vn0+1.0)*(vn0+1.0)+4.0*ART*ART));
			vl0=0.5*(vnl0*(VRT-dv0)-VRT-dv0);
			xvar1=(1.0-vl0/PC);
			xvar2=(1.0-MC);
			xvar3=pow(xvar1,xvar2);
			qlo0=PC*(1.0-xvar3)/(1.0-MC);
			vn=(2.0*(*Vbci)+VRT+dv0)/(VRT-dv0);
			vnl=2.0*vn/(sqrt((vn-1.0)*(vn-1.0)+4.0*AJC*AJC)+sqrt((vn+1.0)*(vn+1.0)+4.0*ART*ART));
			vl=0.5*(vnl*(VRT-dv0)-VRT-dv0);
			xvar1=(1.0-vl/PC);
			xvar2=(1.0-MC);
			xvar3=pow(xvar1,xvar2);
			qlo=PC*(1.0-xvar3)/(1.0-MC);
			sel=0.5*(vnl+1.0);
			xvar1=(1.0+VRT/PC);
			xvar2=(-MC);
			crt=pow(xvar1,xvar2);
			xvar1=(1.0+dv0/PC);
			xvar2=(-MC);
			cmx=pow(xvar1,xvar2);
			cl=(1.0-sel)*crt+sel*cmx;
			ql=((*Vbci)-vl+vl0)*cl;
			qdbc=ql+qlo-qlo0;
		}else{
			mv0=sqrt(dv0*dv0+4.0*AJC*AJC);
			vl0=-0.5*(dv0+mv0);
			xvar1=(1.0-vl0/PC);
			xvar2=(1.0-MC);
			xvar3=pow(xvar1,xvar2);
			q0=-PC*xvar3/(1.0-MC);
			dv=(*Vbci)+dv0;
			mv=sqrt(dv*dv+4.0*AJC*AJC);
			vl=0.5*(dv-mv)-dv0;
			xvar1=(1.0-vl/PC);
			xvar2=(1.0-MC);
			xvar3=pow(xvar1,xvar2);
			qlo=-PC*xvar3/(1.0-MC);
			xvar1=(1.0-FC);
			xvar2=(-MC);
			xvar3=pow(xvar1,xvar2);
			qdbc=qlo+xvar3*((*Vbci)-vl+vl0)-q0;
		}
	}
	dv0=-PC*FC;
	if(AJC<=0.0){
		dvh=(*Vbep)+dv0;
		if(dvh>0.0){
			xvar1=(1.0-FC);
			xvar2=(-1.0-MC);
			pwq=pow(xvar1,xvar2);
			qlo=PC*(1.0-pwq*(1.0-FC)*(1.0-FC))/(1.0-MC);
			qhi=dvh*(1.0-FC+0.5*MC*dvh/PC)*pwq;
		}else{
			if((VRT>0.0)&&((*Vbep)<-VRT)){
				xvar1=(1.0+VRT/PC);
				xvar2=(1.0-MC);
				xvar3=pow(xvar1,xvar2);
				qlo=PC*(1.0-xvar3*(1.0-((1.0-MC)*((*Vbep)+VRT))/(PC+VRT)))/(1.0-MC);
			}else{
				xvar1=(1.0-(*Vbep)/PC);
				xvar2=(1.0-MC);
				xvar3=pow(xvar1,xvar2);
				qlo=PC*(1.0-xvar3)/(1.0-MC);
			}
			qhi=0.0;
		}
		qdbep=qlo+qhi;
	}else{
		if((VRT>0.0)&&(ART>0.0)){
			vn0=(VRT+dv0)/(VRT-dv0);
			vnl0=2.0*vn0/(sqrt((vn0-1.0)*(vn0-1.0)+4.0*AJC*AJC)+sqrt((vn0+1.0)*(vn0+1.0)+4.0*ART*ART));
			vl0=0.5*(vnl0*(VRT-dv0)-VRT-dv0);
			xvar1=(1.0-vl0/PC);
			xvar2=(1.0-MC);
			xvar3=pow(xvar1,xvar2);
			qlo0=PC*(1.0-xvar3)/(1.0-MC);
			vn=(2.0*(*Vbep)+VRT+dv0)/(VRT-dv0);
			vnl=2.0*vn/(sqrt((vn-1.0)*(vn-1.0)+4.0*AJC*AJC)+sqrt((vn+1.0)*(vn+1.0)+4.0*ART*ART));
			vl=0.5*(vnl*(VRT-dv0)-VRT-dv0);
			xvar1=(1.0-vl/PC);
			xvar2=(1.0-MC);
			xvar3=pow(xvar1,xvar2);
			qlo=PC*(1.0-xvar3)/(1.0-MC);
			sel=0.5*(vnl+1.0);
			xvar1=(1.0+VRT/PC);
			xvar2=(-MC);
			crt=pow(xvar1,xvar2);
			xvar1=(1.0+dv0/PC);
			xvar2=(-MC);
			cmx=pow(xvar1,xvar2);
			cl=(1.0-sel)*crt+sel*cmx;
			ql=((*Vbep)-vl+vl0)*cl;
			qdbep=ql+qlo-qlo0;
		}else{
			mv0=sqrt(dv0*dv0+4.0*AJC*AJC);
			vl0=-0.5*(dv0+mv0);
			xvar1=(1.0-vl0/PC);
			xvar2=(1.0-MC);
			xvar3=pow(xvar1,xvar2);
			q0=-PC*xvar3/(1.0-MC);
			dv=(*Vbep)+dv0;
			mv=sqrt(dv*dv+4.0*AJC*AJC);
			vl=0.5*(dv-mv)-dv0;
			xvar1=(1.0-vl/PC);
			xvar2=(1.0-MC);
			xvar3=pow(xvar1,xvar2);
			qlo=-PC*xvar3/(1.0-MC);
			xvar1=(1.0-FC);
			xvar2=(-MC);
			xvar3=pow(xvar1,xvar2);
			qdbep=qlo+xvar3*((*Vbep)-vl+vl0)-q0;
		}
	}
	if(CJCP>0.0){
		dv0=-PS*FC;
		if(AJS<=0.0){
			dvh=(*Vbcp)+dv0;
			if(dvh>0.0){
				xvar1=(1.0-FC);
				xvar2=(-1.0-MS);
				pwq=pow(xvar1,xvar2);
				qlo=PS*(1.0-pwq*(1.0-FC)*(1.0-FC))/(1.0-MS);
				qhi=dvh*(1.0-FC+0.5*MS*dvh/PS)*pwq;
			}else{
				xvar1=(1.0-(*Vbcp)/PS);
				xvar2=(1.0-MS);
				xvar3=pow(xvar1,xvar2);
				qlo=PS*(1.0-xvar3)/(1.0-MS);
				qhi=0.0;
			}
			qdbcp=qlo+qhi;
		}else{
			mv0=sqrt(dv0*dv0+4.0*AJS*AJS);
			vl0=-0.5*(dv0+mv0);
			xvar1=(1.0-vl0/PS);
			xvar2=(1.0-MS);
			xvar3=pow(xvar1,xvar2);
			q0=-PS*xvar3/(1.0-MS);
			dv=(*Vbcp)+dv0;
			mv=sqrt(dv*dv+4.0*AJS*AJS);
			vl=0.5*(dv-mv)-dv0;
			xvar1=(1.0-vl/PS);
			xvar2=(1.0-MS);
			xvar3=pow(xvar1,xvar2);
			qlo=-PS*xvar3/(1.0-MS);
			xvar1=(1.0-FC);
			xvar2=(-MS);
			xvar3=pow(xvar1,xvar2);
			qdbcp=qlo+xvar3*((*Vbcp)-vl+vl0)-q0;
		}
	}else{
		qdbcp=0.0;
	}
	argi=(*Vbei)/(NF*Vtv);
	if(argi>100.0){
		expi=exp(100.0)*(1.0+(argi-100.0));
	}else if(argi<-100.0){
		expi=exp(-100.0)*(1.0+(argi+100.0));
	}else{
		expi=exp(argi);
	}
	Ifi=IS*(expi-1.0);
	argi=(*Vbci)/(NR*Vtv);
	if(argi>100.0){
		expi=exp(100.0)*(1.0+(argi-100.0));
	}else if(argi<-100.0){
		expi=exp(-100.0)*(1.0+(argi+100.0));
	}else{
		expi=exp(argi);
	}
	Iri=IS*ISRR*(expi-1.0);
	q1z=1.0+qdbe*IVER+qdbc*IVEF;
	q1=0.5*(sqrt((q1z-1.0e-4)*(q1z-1.0e-4)+1.0e-8)+q1z-1.0e-4)+1.0e-4;
	q2=Ifi*IIKF+Iri*IIKR;
	if(QBM<0.5){
		xvar2=1.0/NKF;
		xvar3=pow(q1,xvar2);
		xvar1=(xvar3+4.0*q2);
		xvar4=pow(xvar1,NKF);
		qb=0.5*(q1+xvar4);
	}else{
		xvar1=(1.0+4.0*q2);
		xvar2=pow(xvar1,NKF);
		qb=0.5*q1*(1.0+xvar2);
	}
	(*Itzr)=Iri/qb;
	Itzf=Ifi/qb;
	(*Ixzf)=-Itzf;
	(*Itxf)=(*Vrxf);
	(*Ixxf)=(*Vrxf);
	if(ISP>0.0){
		argi=(*Vbep)/(NFP*Vtv);
		if(argi>100.0){
			expi=exp(100.0)*(1.0+(argi-100.0));
		}else if(argi<-100.0){
			expi=exp(-100.0)*(1.0+(argi+100.0));
		}else{
			expi=exp(argi);
		}
		argx=(*Vbci)/(NFP*Vtv);
		if(argx>100.0){
			expx=exp(100.0)*(1.0+(argx-100.0));
		}else if(argx<-100.0){
			expx=exp(-100.0)*(1.0+(argx+100.0));
		}else{
			expx=exp(argx);
		}
		Ifp=ISP*(WSP*expi+(1.0-WSP)*expx-1.0);
		q2p=Ifp*IIKP;
		qbp=0.5*(1.0+sqrt(1.0+4.0*q2p));
		argi=(*Vbcp)/(NFP*Vtv);
		if(argi>100.0){
			expi=exp(100.0)*(1.0+(argi-100.0));
		}else if(argi<-100.0){
			expi=exp(-100.0)*(1.0+(argi+100.0));
		}else{
			expi=exp(argi);
		}
		Irp=ISP*(expi-1.0);
		(*Iccp)=(Ifp-Irp)/qbp;
	}else{
		Ifp=0.0;
		qbp=1.0;
		(*Iccp)=0.0;
	}
	if(WBE==1.0){
		argi=(*Vbei)/(NEI*Vtv);
		if(argi>100.0){
			expi=exp(100.0)*(1.0+(argi-100.0));
		}else if(argi<-100.0){
			expi=exp(-100.0)*(1.0+(argi+100.0));
		}else{
			expi=exp(argi);
		}
		argn=(*Vbei)/(NEN*Vtv);
		if(argn>100.0){
			expn=exp(100.0)*(1.0+(argn-100.0));
		}else if(argn<-100.0){
			expn=exp(-100.0)*(1.0+(argn+100.0));
		}else{
			expn=exp(argn);
		}
		if(VBBE>0.0){
			argx=(-VBBE-(*Vbei))/(NBBE*Vtv);
			if(argx>100.0){
				expx=exp(100.0)*(1.0+(argx-100.0));
			}else if(argx<-100.0){
				expx=exp(-100.0)*(1.0+(argx+100.0));
			}else{
				expx=exp(argx);
			}
			(*Ibe)=IBEI*(expi-1.0)+IBEN*(expn-1.0)-IBBE*(expx-EBBE);
		}else{
			(*Ibe)=IBEI*(expi-1.0)+IBEN*(expn-1.0);
		}
		(*Ibex)=0.0;
	}else if(WBE==0.0){
		(*Ibe)=0.0;
		argi=(*Vbex)/(NEI*Vtv);
		if(argi>100.0){
			expi=exp(100.0)*(1.0+(argi-100.0));
		}else if(argi<-100.0){
			expi=exp(-100.0)*(1.0+(argi+100.0));
		}else{
			expi=exp(argi);
		}
		argn=(*Vbex)/(NEN*Vtv);
		if(argn>100.0){
			expn=exp(100.0)*(1.0+(argn-100.0));
		}else if(argn<-100.0){
			expn=exp(-100.0)*(1.0+(argn+100.0));
		}else{
			expn=exp(argn);
		}
		if(VBBE>0.0){
			argx=(-VBBE-(*Vbex))/(NBBE*Vtv);
			if(argx>100.0){
				expx=exp(100.0)*(1.0+(argx-100.0));
			}else if(argx<-100.0){
				expx=exp(-100.0)*(1.0+(argx+100.0));
			}else{
				expx=exp(argx);
			}
			(*Ibex)=IBEI*(expi-1.0)+IBEN*(expn-1.0)-IBBE*(expx-EBBE);
		}else{
			(*Ibex)=IBEI*(expi-1.0)+IBEN*(expn-1.0);
		}
	}else{
		argi=(*Vbei)/(NEI*Vtv);
		if(argi>100.0){
			expi=exp(100.0)*(1.0+(argi-100.0));
		}else if(argi<-100.0){
			expi=exp(-100.0)*(1.0+(argi+100.0));
		}else{
			expi=exp(argi);
		}
		argn=(*Vbei)/(NEN*Vtv);
		if(argn>100.0){
			expn=exp(100.0)*(1.0+(argn-100.0));
		}else if(argn<-100.0){
			expn=exp(-100.0)*(1.0+(argn+100.0));
		}else{
			expn=exp(argn);
		}
		if(VBBE>0.0){
			argx=(-VBBE-(*Vbei))/(NBBE*Vtv);
			if(argx>100.0){
				expx=exp(100.0)*(1.0+(argx-100.0));
			}else if(argx<-100.0){
				expx=exp(-100.0)*(1.0+(argx+100.0));
			}else{
				expx=exp(argx);
			}
			(*Ibe)=WBE*(IBEI*(expi-1.0)+IBEN*(expn-1.0)-IBBE*(expx-EBBE));
		}else{
			(*Ibe)=WBE*(IBEI*(expi-1.0)+IBEN*(expn-1.0));
		}
		argi=(*Vbex)/(NEI*Vtv);
		if(argi>100.0){
			expi=exp(100.0)*(1.0+(argi-100.0));
		}else if(argi<-100.0){
			expi=exp(-100.0)*(1.0+(argi+100.0));
		}else{
			expi=exp(argi);
		}
		argn=(*Vbex)/(NEN*Vtv);
		if(argn>100.0){
			expn=exp(100.0)*(1.0+(argn-100.0));
		}else if(argn<-100.0){
			expn=exp(-100.0)*(1.0+(argn+100.0));
		}else{
			expn=exp(argn);
		}
		if(VBBE>0.0){
			argx=(-VBBE-(*Vbex))/(NBBE*Vtv);
			if(argx>100.0){
				expx=exp(100.0)*(1.0+(argx-100.0));
			}else if(argx<-100.0){
				expx=exp(-100.0)*(1.0+(argx+100.0));
			}else{
				expx=exp(argx);
			}
			(*Ibex)=(1.0-WBE)*(IBEI*(expi-1.0)+IBEN*(expn-1.0)-IBBE*(expx-EBBE));
		}else{
			(*Ibex)=(1.0-WBE)*(IBEI*(expi-1.0)+IBEN*(expn-1.0));
		}
	}
	argi=(*Vbci)/(NCI*Vtv);
	if(argi>100.0){
		expi=exp(100.0)*(1.0+(argi-100.0));
	}else if(argi<-100.0){
		expi=exp(-100.0)*(1.0+(argi+100.0));
	}else{
		expi=exp(argi);
	}
	argn=(*Vbci)/(NCN*Vtv);
	if(argn>100.0){
		expn=exp(100.0)*(1.0+(argn-100.0));
	}else if(argn<-100.0){
		expn=exp(-100.0)*(1.0+(argn+100.0));
	}else{
		expn=exp(argn);
	}
	Ibcj=IBCI*(expi-1.0)+IBCN*(expn-1.0);
	if((IBEIP>0.0)||(IBENP>0.0)){
		argi=(*Vbep)/(NCI*Vtv);
		if(argi>100.0){
			expi=exp(100.0)*(1.0+(argi-100.0));
		}else if(argi<-100.0){
			expi=exp(-100.0)*(1.0+(argi+100.0));
		}else{
			expi=exp(argi);
		}
		argn=(*Vbep)/(NCN*Vtv);
		if(argn>100.0){
			expn=exp(100.0)*(1.0+(argn-100.0));
		}else if(argn<-100.0){
			expn=exp(-100.0)*(1.0+(argn+100.0));
		}else{
			expn=exp(argn);
		}
		(*Ibep)=IBEIP*(expi-1.0)+IBENP*(expn-1.0);
	}else{
		(*Ibep)=0.0;
	}
	if(AVC1>0.0){
		vl=0.5*(sqrt((PC-(*Vbci))*(PC-(*Vbci))+0.01)+(PC-(*Vbci)));
		xvar2=(MC-1.0);
		xvar3=pow(vl,xvar2);
		xvar1=-AVC2*xvar3;
		if(xvar1>100.0){
			xvar4=exp(100.0)*(1.0+(xvar1-100.0));
		}else if(xvar1<-100.0){
			xvar4=exp(-100.0)*(1.0+(xvar1+100.0));
		}else{
			xvar4=exp(xvar1);
		}
		avalf=AVC1*vl*xvar4;
		Igc=((*Itxf)-(*Itzr)-Ibcj)*avalf;
	}else{
		Igc=0.0;
	}
	(*Ibc)=Ibcj-Igc;
	if(RCX>0.0){
		(*Ircx)=(*Vrcx)/RCX;
	}else{
		(*Ircx)=0.0;
	}
	argi=(*Vbci)/Vtv;
	if(argi>100.0){
		expi=exp(100.0)*(1.0+(argi-100.0));
	}else if(argi<-100.0){
		expi=exp(-100.0)*(1.0+(argi+100.0));
	}else{
		expi=exp(argi);
	}
	argx=(*Vbcx)/Vtv;
	if(argx>100.0){
		expx=exp(100.0)*(1.0+(argx-100.0));
	}else if(argx<-100.0){
		expx=exp(-100.0)*(1.0+(argx+100.0));
	}else{
		expx=exp(argx);
	}
	Kbci=sqrt(1.0+GAMM*expi);
	Kbcx=sqrt(1.0+GAMM*expx);
	if(RCI>0.0){
		rKp1=(Kbci+1.0)/(Kbcx+1.0);
		xvar1=log(rKp1);
		Iohm=((*Vrci)+Vtv*(Kbci-Kbcx-xvar1))/RCI;
		derf=IVO*RCI*Iohm/(1.0+0.5*IVO*IHRCF*sqrt((*Vrci)*(*Vrci)+0.01));
		(*Irci)=Iohm/sqrt(1.0+derf*derf);
	}else{
		(*Irci)=0.0;
	}
	if(RBX>0.0){
		(*Irbx)=(*Vrbx)/RBX;
	}else{
		(*Irbx)=0.0;
	}
	if(RBI>0.0){
		(*Irbi)=(*Vrbi)*qb/RBI;
	}else{
		(*Irbi)=0.0;
	}
	if(RE>0.0){
		(*Ire)=(*Vre)/RE;
	}else{
		(*Ire)=0.0;
	}
	if(RBP>0.0){
		(*Irbp)=(*Vrbp)*qbp/RBP;
	}else{
		(*Irbp)=0.0;
	}
	if((IBCIP>0.0)||(IBCNP>0.0)){
		argi=(*Vbcp)/(NCIP*Vtv);
		if(argi>100.0){
			expi=exp(100.0)*(1.0+(argi-100.0));
		}else if(argi<-100.0){
			expi=exp(-100.0)*(1.0+(argi+100.0));
		}else{
			expi=exp(argi);
		}
		argn=(*Vbcp)/(NCNP*Vtv);
		if(argn>100.0){
			expn=exp(100.0)*(1.0+(argn-100.0));
		}else if(argn<-100.0){
			expn=exp(-100.0)*(1.0+(argn+100.0));
		}else{
			expn=exp(argn);
		}
		(*Ibcp)=IBCIP*(expi-1.0)+IBCNP*(expn-1.0);
	}else{
		(*Ibcp)=0.0;
	}
	if(RS>0.0){
		(*Irs)=(*Vrs)/RS;
	}else{
		(*Irs)=0.0;
	}
	if(Ifi>0.0){
		sgIf=1.0;
	}else{
		sgIf=0.0;
	}
	rIf=Ifi*sgIf*IITF;
	mIf=rIf/(rIf+1.0);
	xvar1=(*Vbci)*IVTF/1.44;
	if(xvar1>100.0){
		xvar2=exp(100.0)*(1.0+(xvar1-100.0));
	}else if(xvar1<-100.0){
		xvar2=exp(-100.0)*(1.0+(xvar1+100.0));
	}else{
		xvar2=exp(xvar1);
	}
	tff=TF*(1.0+QTF*q1)*(1.0+XTF*xvar2*(slTF+mIf*mIf)*sgIf);
	(*Qbe)=CJE*qdbe*WBE+tff*Ifi/qb;
	(*Qbex)=CJE*qdbex*(1.0-WBE);
	(*Qbc)=CJC*qdbc+TR*Iri+QCO*Kbci;
	(*Qbcx)=QCO*Kbcx;
	(*Qbep)=CJEP*qdbep+TR*Ifp;
	(*Qbcp)=CJCP*qdbcp+CCSO*(*Vbcp);
	(*Qbeo)=(*Vbe)*CBEO;
	(*Qbco)=(*Vbc)*CBCO;
	(*Flxf)=LEP*(*Ixxf);
	(*Qcxf)=CEP*(*Vcxf);

/*	Scale outputs */
	if(*SCALE!=1.0){
		*Ibe=(*SCALE)*(*Ibe);
		*Ibex=(*SCALE)*(*Ibex);
		*Itxf=(*SCALE)*(*Itxf);
		*Itzr=(*SCALE)*(*Itzr);
		*Ibc=(*SCALE)*(*Ibc);
		*Ibep=(*SCALE)*(*Ibep);
		*Ircx=(*SCALE)*(*Ircx);
		*Irci=(*SCALE)*(*Irci);
		*Irbx=(*SCALE)*(*Irbx);
		*Irbi=(*SCALE)*(*Irbi);
		*Ire=(*SCALE)*(*Ire);
		*Irbp=(*SCALE)*(*Irbp);
		*Qbe=(*SCALE)*(*Qbe);
		*Qbex=(*SCALE)*(*Qbex);
		*Qbc=(*SCALE)*(*Qbc);
		*Qbcx=(*SCALE)*(*Qbcx);
		*Qbep=(*SCALE)*(*Qbep);
		*Qbeo=(*SCALE)*(*Qbeo);
		*Qbco=(*SCALE)*(*Qbco);
		*Ibcp=(*SCALE)*(*Ibcp);
		*Iccp=(*SCALE)*(*Iccp);
		*Irs=(*SCALE)*(*Irs);
		*Qbcp=(*SCALE)*(*Qbcp);
		*Ixzf=(*SCALE)*(*Ixzf);
		*Ixxf=(*SCALE)*(*Ixxf);
		*Qcxf=(*SCALE)*(*Qcxf);
		*Flxf=(*SCALE)*(*Flxf);
	}
	return(0);
}
